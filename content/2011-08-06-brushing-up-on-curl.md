---
layout: post
title: "Brushing up on cURL"
date: 2011-08-06T09:51:00-07:00
---

<div class='post'>
The <a href="http://curl.haxx.se/" target="_blank">curl command line tool</a> is a great addition to your toolbox when working on web-related testing projects.<br /><br />It's difficult to add up all the ways curl is useful for testing tasks. &nbsp;Here's an attempt at documenting a few simple scenarios.<br /><br /><h3>Installing the curl command line tool</h3><br />OSX ships with a copy of curl pre-installed, so Mac users have nothing to do here.<br /><br />Any Linux distribution should either have curl preinstalled - or it should be trivial to install curl with your package management system.<br /><br />On Windows, you can download a binary release of curl to get up and running quickly - I recommend using cygwin, or I've also had good luck with the curl 7.21.7 build found in the "Win32 Generic" section (provided by GÃ¼nter Knauf) at the bottom of this page:<br /><br /><a href="http://curl.haxx.se/download.html">http://curl.haxx.se/download.html</a><br /><br /><h3>To make a GET request for a file, and save a local copy:</h3><br />Sometimes it's useful to fetch a file from a server and compare it (or its md5 hash) to a known file, to make sure you received the right content - so curl to the rescue:<br /><br /><pre style="background-color: #ddffdd;">curl --remote-name http://www.w3schools.com/images/pulpit.jpg</pre><br />The --remote-name option tells curl to save a local copy of the file using the same name found on the remote server.<br /><br />After running the command above, a copy of pulpit.jpg should appear in your current local directory.<br /><br />Example output:<br /><br /><pre style="background-color: #ddffdd;">curl --remote-name http://www.w3schools.com/images/pulpit.jpg<br /><br />  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br />                                 Dload  Upload   Total   Spent    Left  Speed<br />100 75672  100 75672    0     0   100k      0 --:--:-- --:--:-- --:--:--  115k</pre><br /><h3>Using the --silent option for minimal output</h3><br />You most likely noticed the progress output that curl prints when the command above is run.<br /><br />The handy --silent option allows one to suppress that information:<br /><br /><pre style="background-color: #ddffdd;">curl --silent --remote-name http://www.w3schools.com/images/pulpit.jpg</pre><br /><h3>Using curl's --write-out option to print extra information about a request</h3><br />--write-out is extremely useful.  This option allows you to specify extra information that you want curl to print, using special variables.<br /><br />For example, to print the HTTP response code of your request, you use the "http_code" variable.<br /><br />You must enclose the variables in %{}.  For example:<br /><br /><pre style="background-color: #ddffdd;">--write-out %{http_code}</pre><br />Here's a real example of using the option.  Note the "200" response code value that curl prints:<br /><br /><pre style="background-color: #ddffdd;">curl --write-out %{http_code} --silent --remote-name http://www.w3schools.com/images/pulpit.jpg<br />200</pre><br />You can also pass multiple variables to --write-out, and create your own format string, so that it's easy to tell what each value represents.<br /><br />You can even use newlines in your format string, using \n as shown here:<br /><br /><pre style="background-color: #ddffdd;">--write-out "Response code: %{http_code}\nTotal time: %{time_total}"</pre><br />Real example of the above:<br /><br /><pre style="background-color: #ddffdd;">curl --write-out "Response code: %{http_code}\nTotal time: %{time_total}" --silent --remote-name http://www.w3schools.com/images/pulpit.jpg<br /><br />Response code: 200<br />Total time: 0.797</pre><br /><h3>Using curl to test redirects</h3><br />--write-out can also be used to make sure that a URL that should redirect the client is successfully doing so.<br /><br />Even better, you can see what URL the server is telling you to redirect to.<br /><br />As an example, the URL "http://www.gmail.com/" currently redirects to "http://mail.google.com/".<br /><br />To test this on the command line, you can use the "redirect_url" variable with --write-out:<br /><br /><pre style="background-color: #ddffdd;">curl --write-out "\nResponse code: %{http_code}\nRedirect URL: %{redirect_url}" http://www.gmail.com/</pre><br />Running the above command should result in this output:<br /><br /><pre style="background-color: #ddffdd;">&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;<br />&lt;TITLE&gt;301 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;<br />&lt;H1&gt;301 Moved&lt;/H1&gt;<br />The document has moved<br />&lt;A HREF=\"http://mail.google.com/mail/\"&gt;here&lt;/A&gt;.<br />&lt;/BODY&gt;&lt;/HTML&gt;<br /><br />Response code: 301<br />Redirect URL: http://mail.google.com/mail/<br /></pre><br /><h3>Using --include and --verbose</h3><br />More verbose ways of scrutinizing the server's response are available, via the --include or --verbose options.<br /><br />--include prints all the headers sent by the server in response to the request.  Very cool!<br /><br /><pre style="background-color: #ddffdd;">curl --include http://www.gmail.com/<br /><br />HTTP/1.1 301 Moved Permanently<br />Location: http://mail.google.com/mail/<br />Content-Type: text/html; charset=UTF-8<br />X-Content-Type-Options: nosniff<br />Date: Mon, 01 Aug 2011 18:27:53 GMT<br />Expires: Wed, 31 Aug 2011 18:27:53 GMT<br />Server: sffe<br />Content-Length: 225<br />X-XSS-Protection: 1; mode=block<br />Cache-Control: public, max-age=2592000<br />Age: 75580<br /><br />&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;<br />&lt;TITLE&gt;301 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;<br />&lt;H1&gt;301 Moved&lt;/H1&gt;<br />The document has moved<br />&lt;A HREF=\"http://mail.google.com/mail/\"&gt;here&lt;/A&gt;.<br />&lt;/BODY&gt;&lt;/HTML&gt;<br /></pre><br /><br />--verbose expands on that by also printing the headers sent by you (the client) and some other diagnostic info:<br /><br /><pre style="background-color: #ddffdd;">curl --verbose http://www.gmail.com/<br /><br />* About to connect() to www.gmail.com port 80 (#0)<br />*   Trying 74.125.127.19... connected<br />* Connected to www.gmail.com (74.125.127.19) port 80 (#0)<br />&gt; GET / HTTP/1.1<br />&gt; User-Agent: curl/7.19.7 (universal-apple-darwin10.0) libcurl/7.19.7 OpenSSL/0.9.8l zlib/1.2.3<br />&gt; Host: www.gmail.com<br />&gt; Accept: */*<br />&gt;<br />&lt; HTTP/1.1 301 Moved Permanently<br />&lt; Location: http://mail.google.com/mail/<br />&lt; Content-Type: text/html; charset=UTF-8<br />&lt; X-Content-Type-Options: nosniff<br />&lt; Date: Thu, 28 Jul 2011 03:17:12 GMT<br />&lt; Expires: Sat, 27 Aug 2011 03:17:12 GMT<br />&lt; Server: sffe<br />&lt; Content-Length: 225<br />&lt; X-XSS-Protection: 1; mode=block<br />&lt; Cache-Control: public, max-age=2592000<br />&lt; Age: 476015<br />&lt;<br />&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;<br />&lt;TITLE&gt;301 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;<br />&lt;H1&gt;301 Moved&lt;/H1&gt;<br />The document has moved<br />&lt;A HREF=\"http://mail.google.com/mail/\"&gt;here&lt;/A&gt;.<br />&lt;/BODY&gt;&lt;/HTML&gt;<br />* Connection #0 to host www.gmail.com left intact<br />* Closing connection #0<br /></pre><br /><h3>To sum up:</h3><br /><div>This only scratches the surface of what is possible with curl.  For more information, see:</div><br /><div><a href="http://curl.haxx.se/docs/manpage.html" target="_blank">http://curl.haxx.se/docs/manpage.html</a></div><br /><div><a href="http://curl.haxx.se/docs/httpscripting.html" target="_blank">http://curl.haxx.se/docs/httpscripting.html</a></div></div>
